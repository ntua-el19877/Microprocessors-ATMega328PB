
main:
    ;init stack pointer
    ldi r24,low(RAMEND)
    out SPL,r24
    ldi r24,high(RAMEND)
    out SPH,r24
    
    ;init portd as lcd output
    ser r24
    out DDRD,r24  
    clr r24
    
main1: 
    ;lcd init
    rcall lcd_init 
    
    ldi r24, low(2)
    ldi r25, high(2) 
    rcall wait_msec
    
    ldi r24, 'A'
    rcall lcd_data ; ???????? ???? byte ????????? ???? ??????? ??? ?????? lcd
    
    ldi r24, low(2000)
    ldi r25, high(2000) 
    rcall wait_msec
    
    jmp main1

lcd_init: 
    ldi r24 ,40 ; ???? ? ???????? ??? lcd ????????????? ?? 
    ldi r25 ,0 ; ????? ??????? ??? ???? ??? ????????????.
    rcall wait_msec ; ??????? 40 msec ????? ???? ?? ???????????.
    
    ldi r24 ,0x30 ; ?????? ????????? ?? 8 bit mode
    out PORTD ,r24 ; ?????? ??? ???????? ?? ??????? ???????
    sbi PORTD ,PD3 ; ??? ?? ?????????? ??????? ??? ???????
    cbi PORTD ,PD3 ; ??? ??????, ? ?????? ???????????? ??? ?????
    ldi r24 ,39
    ldi r25 ,0 ; ??? ? ???????? ??? ?????? ????????? ?? 8-bit mode
    rcall wait_usec ; ??? ?? ?????? ??????, ???? ?? ? ???????? ???? ??????????
    ; ??????? 4 bit ?? ??????? ?? ?????????? 8 bit
    
    ldi r24 ,0x30 
    out PORTD ,r24
    sbi PORTD ,PD3
    cbi PORTD ,PD3
    ldi r24 ,39
    ldi r25 ,0
    rcall wait_usec 
    
    ldi r24 ,0x20 ; ?????? ?? 4-bit mode
    out PORTD ,r24
    sbi PORTD ,PD3
    cbi PORTD ,PD3
    ldi r24 ,39
    ldi r25 ,0
    rcall wait_usec 
    
    ldi r24 ,0x28 ; ??????? ?????????? ???????? 5x8 ????????
    rcall lcd_command ; ??? ???????? ??? ??????? ???? ?????
    
    ldi r24 ,0x0c ; ???????????? ??? ??????, ???????? ??? ???????
    rcall lcd_command 
    
    ldi r24 ,0x01 ; ?????????? ??? ??????
    rcall lcd_command
    
    ldi r24 ,low(1530)
    ldi r25 ,high(1530)
    rcall wait_usec 
    
    ldi r24 ,0x06 ; ???????????? ????????? ??????? ???? 1 ??? ?????????? 
    rcall lcd_command ; ??? ????? ???????????? ???? ??????? ??????????? ??? 
    ; ?????????????? ??? ????????? ????????? ??? ??????
    ret
